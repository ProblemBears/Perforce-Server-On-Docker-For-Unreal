# Perforce Server Docker Compose Configuration
# 
# This runs a single Perforce (Helix Core) server in a Docker container
# Configured for Unreal Engine projects with case-insensitive mode
#
# BEFORE RUNNING:
# 1. Change P4PASSWD below to your desired password
# 2. Update volume paths if your Synology doesn't use /volume1/
# 3. Create the required folders (see README.md)

networks:
  perforce_network:
    driver: bridge

services:
  perforce:
    container_name: Perforce-Server
    hostname: perforce
    
    # Volume mappings - data persists here on your NAS
    # UPDATE THESE PATHS if your volume name is different (e.g., volume2)
    volumes:
      - /volume1/docker/perforce/logs:/data/p4depot/logs
      - /volume1/docker/perforce/data:/data
    
    # Ports exposed to your network
    ports:
      - "1666:1666"  # Main Perforce server port (use this in P4V)
      # - "8080:8080"  # Optional: uncomment for web interface
    
    # Environment variables - CHANGE THE PASSWORD!
    environment:
      - P4PORT=ssl:1666                          # Use SSL encryption
      - P4SSLDIR=/data/p4depot/ssl              # SSL certificate location
      - P4ROOT=/data/p4depot                    # Depot root directory
      - P4USER=p4admin                          # Admin username (you can change this)
      - P4PASSWD=CHANGE_ME_YOUR_PASSWORD_HERE   # ⚠️ CHANGE THIS PASSWORD!
    
    # Build configuration - builds from local Dockerfile
    build:
      context: .
      dockerfile: Dockerfile
    
    # Auto-restart policy (survives NAS reboots and power outages)
    restart: unless-stopped
    
    networks:
      - perforce_network